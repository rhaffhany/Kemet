<section class="py-5">

    <div class="container">

        <div class="row">
            <div class="col-md-6 mt-5">
                <h1 class="fw-bolder mb-1">{{activityDetails.name}}</h1>
                <div class="rating d-flex">
                    <span *ngFor="let star of [1, 2, 3, 4, 5]; let i = index" class="rate">
                        <!-- Full Star -->
                        <svg *ngIf="i + 1 <= activityDetails.averageRating" width="24" height="24" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg" fill="#FAC817" stroke="currentColor"
                             stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                          <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                        </svg>
                      
                        <!-- Half Star -->
                        <svg *ngIf="i < activityDetails.averageRating && i + 1 > activityDetails.averageRating" width="24" height="24" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="1"
                             stroke-linecap="round" stroke-linejoin="round">
                          <defs>
                            <linearGradient id="half-fill" x1="0" x2="1" y1="0" y2="0">
                              <stop offset="50%" stop-color="#FAC817"/>
                              <stop offset="50%" stop-color="#FFE5C2"/>
                            </linearGradient>
                          </defs>
                          <polygon fill="url(#half-fill)" points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                        </svg>
                          <!-- Empty Star -->
                          <svg *ngIf="i + 1 > activityDetails.averageRating" width="24" height="24" viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg" fill="#FFE5C2" stroke="currentColor"
                            stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                        </svg>
                    </span>
                <p style="font-size: 20px;" class="ms-1 mb-0">reviews</p>
                <!-- <img [src]="blackDot" alt="dot" class="mx-2 mt-2">
                <p style="font-size: 20px;" class="mb-0">Historic Walking Area</p> -->
                </div>
                <div class="mt-2">
                    <a [routerLink]="['/write-review/activity', activityID]" class="text-decoration-none text-black review-link">
                        <span class="review" style="font-size: 20px; font-weight: 500;">Write a review</span>
                    </a>
                </div>
            </div>
        </div>

        <div class="row gap-4 mt-3">

            <div class="col-md-4 p-4 about bg-white ">
                <h5 class="fw-bold" style="font-size: 20px;">About</h5>
                <div class="about-content">
                    <p style="line-height: 24.2px;" >{{activityDetails.description}}</p>
                </div>
                <div class="about-items">
                    <div class="d-flex align-items-center mb-2">
                        <i class="fa-regular fa-clock"></i>
                        <p class="mb-0 ms-2">Open Time: {{activityDetails.openTime}},</p>
                        <p class="mb-0 ms-2">Close Time: {{activityDetails.closeTime}}</p>
                    </div>
                    <div class="d-flex align-items-center">
                        <i class="fa-regular fa-clock"></i>
                        <p class="mb-1 ms-2">Duration {{activityDetails.duration}}</p>
                    </div>
                    <!-- <div class="tickets">
                        <div class="d-flex align-items-center ">
                            <img [src]="ticket" alt="ticket" style="height: 20px; width: 20px;">
                            <p class="mb-0 ms-1" style="font-weight:600;">Egyptian:</p>                   
                        </div>
                        <div class="d-flex justify-content-around">
                            <p class="mb-0">Adults <span class="text-muted " style="font-size: 14px;">{{ activityDetails.egyptianAdult | currency:'EGP'}}</span></p>
                            <p class="mb-0">Students <span class="text-muted " style="font-size: 14px;">{{ activityDetails.egyptianStudent | currency:'EGP'}}</span></p>
                        </div>
                    </div>
                    <div class="tickets">
                        <div class="d-flex align-items-center ">
                            <img [src]="ticket" alt="ticket" style="height: 20px; width: 20px;">
                            <p class="mb-0 ms-1" style="font-weight:600;">Tourist:</p>                   
                        </div>
                        <div class="d-flex justify-content-around ">
                            <p class="mb-4">Adults <span class="text-muted" style="font-size: 14px;">{{ activityDetails.touristAdult | currency:'EGP'}}</span></p>
                            <p class="mb-4">Students <span class="text-muted" style="font-size: 14px;">{{ activityDetails.touristStudent | currency:'EGP'}}</span></p>
                        </div>
                    </div> -->
                    <div class="tourist-prices mt-3 d-flex">
                        <i class="fa-solid fa-earth-americas pe-3" style="font-size: 45px;"></i>
                        <div class="d-block">
                            <p class="" style="font-size: 15px; font-weight: 500;">Tourist</p>  
                            <p class="text-muted">Adult : {{activityDetails.touristAdult | currency: '£'}}</p> 
                            <p class="text-muted">Student : {{activityDetails.touristStudent | currency: '£'}}</p> 
                        </div>
                    </div>
                    <div class="egyptian-prices mt-3 d-flex">
                        <img [src]="egyptFlag" alt="Egypt Flag" class="pe-3" style="width: 65px; height: 50px;">
                        <div class="d-block">
                            <p class="mt-1" style="font-size: 15px; font-weight: 500;">Egyptian</p>  
                            <p class="text-muted">Adult : {{activityDetails.egyptianAdult | currency: '£'}}</p> 
                            <p class="text-muted">Student : {{activityDetails.egyptianStudent | currency: '£'}}</p> 
                        </div>
                    </div>
                </div>

                <h5 class="fw-bold pt-2">Tours and Experiences</h5>
                <p style="line-height: 24.2px;">Explore different ways to experience
                    this place.</p>

                <!-- <h5 class="fw-bold pt-3 mb-3">Admission Tickets</h5>
                <p style="line-height: 24.2px;">from <span class="fw-bolder" style="font-size: 24px;">{{activityDetails.egyptianStudent | currency:'EGP'}}</span></p>
                <button class="btn-info w-100 py-3 mt-3">See Tickets</button> -->

            </div>

            <div class="col-md-7 photos">
              <div id="imageCarousel" class="carousel slide" data-bs-ride="carousel">
                <!-- Large Image Display -->
                <div class="carousel-inner ">
                  <div class="carousel-item active">
                    <img [src]="activityDetails.imageURLs.$values[0] || notFoundImg" class="d-block w-100 img-lg" alt="Large Image" style="border-radius: 20px;">
                  </div>
                </div>
            
                <!-- Thumbnail Carousel (Scrollable) -->
                <div class="carousel-thumbnails d-flex mt-3" style="overflow-x: auto;">
                  <div *ngFor="let imgUrl of activityDetails.imageURLs?.$values; let i = index" class="thumbnail-item" (click)="updateLargeImage(i)">
                    <img [src]="imgUrl || notFoundImg" class="img-fluid rounded mb-2" style="cursor: pointer; max-width: 80px; margin-right: 10px;" alt="Thumbnail">
                  </div>
                </div>
              </div>
            </div>

        </div>

        <div class="row py-5">
            <div class="col">
                <p class="tips-title text-center" style="font-size: 20px; font-weight: 600;">Culture tips</p>
                <div class="tips-container d-flex justify-content-center flex-wrap">
                    <p 
                    *ngFor="let tip of activityDetails.culturalTips.split(',')" 
                    class="tip-item shadow-lg me-2 mb-2 px-3 py-2">
                    {{ tip }}
                  </p>                
                </div>
            </div>
        </div>

    </div>

   <!-- Past Reviews -->
   <div class="container-fluid">
    <h3 class="text-center pb-5" style="font-weight: 600;">See what travelers are saying</h3>
    <div class="row gap-2 align-items-center justify-content-center" >

        <div class="col-md-3 reviews reviews-box bg-light-subtle p-4" *ngFor="let review of reviewsData.slice(0,3); " style="border-radius: 20px;">

            <div class="profile-info d-flex justify-content-between">
                <div class="d-flex">
                    <img [src]="review?.userImageURl " 
                    class="profile-pic rounded-circle" 
                    alt="profile-pic"
                    (error)="handleImageError($event)"
                    (change)="uploadProfileImg($event)">
                    <div class="ms-2 d-block">
                        <p class="fw-bold m-0">{{review.username}}</p>
                        <p class="text-muted mb-1" style="font-size:13px;">{{review.nationality}}</p>
                        <div class="rating">
                            <span *ngFor="let star of [1, 2, 3, 4, 5]; let i = index" class="rate">
                                <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"
                                  [style.fill]="i < review.rating ? '#FAC817' : '#FFFFFF'"
                                  stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                                  <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                                </svg>
                            </span>
                        </div>
                    </div>
                </div>
                <div>
                    <i class="fa-solid fa-ellipsis" role="button"></i>
                </div>
            </div>

            <div class="review-content">
                <h5 class="mt-3" style="font-weight: 600;">{{review.reviewTitle}}</h5>
                <p style="line-height: 16.94px; font-size: 14px;">{{review.comment}}</p>
            </div>

            <div class="review-info">
                <p class="m-0" style="font-size: 14px;">Visited <span class="fw-bold">{{review.date | date: 'MMMM y' }}</span></p>
                <p style="font-size: 14px;">Traveled <span class="fw-bold">with {{review.visitorType}}</span></p>
            </div>

            <div class="additional-info">
                <p style="font-size: 13px;">Written {{review.createdAt | date: 'MMMM d, y' }}</p>
            </div>

        </div>

    </div>
   </div>
    

    <!-- All Reviews -->
    <div class="container mt-5 py-5">
        <h3 class="fw-bold mb-5">Reviews</h3>
        <div class="row gap-3 align-content-center justify-content-center">

            <div class="col-lg-3 col-md-5 col-sm-6">
                <div class="reviews-avg-box bg-white p-3" style="border-radius: 20px;">
                    <div class="d-flex align-items-center">
                        <h3 class="fw-bolder me-2 mb-0">{{activityDetails.averageRating}}</h3>
                        <span *ngFor="let star of [1, 2, 3, 4, 5]; let i = index" class="rate">
                            <!-- Full Star -->
                            <svg *ngIf="i + 1 <= activityDetails.averageRating" width="24" height="24" viewBox="0 0 24 24"
                                 xmlns="http://www.w3.org/2000/svg" fill="#FAC817" stroke="currentColor"
                                 stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                              <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                            </svg>
                          
                            <!-- Half Star -->
                            <svg *ngIf="i < activityDetails.averageRating && i + 1 > activityDetails.averageRating" width="24" height="24" viewBox="0 0 24 24"
                                 xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="1"
                                 stroke-linecap="round" stroke-linejoin="round">
                              <defs>
                                <linearGradient id="half-fill" x1="0" x2="1" y1="0" y2="0">
                                  <stop offset="50%" stop-color="#FAC817"/>
                                  <stop offset="50%" stop-color="#FFFFFF"/>
                                </linearGradient>
                              </defs>
                              <polygon fill="url(#half-fill)" points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                            </svg>

                             <!-- Empty Star -->
                            <svg *ngIf="i + 1 > activityDetails.averageRating" width="24" height="24" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg" fill="#FFFFFF" stroke="currentColor"
                                stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                            </svg>

                        </span>
                        <!-- <p class="mb-1 ms-2" style="font-size: 13px; color: rgba(51, 51, 51, 0.63);">2,256,896</p> -->
                    </div>

                    <div class="rating-rate d-block align-items-center p-2">                          
                        <div class="rating-box d-flex align-items-center gap-2  ">
                            <h4 class="m-0" style="font-size: 20px;" >5</h4>
                            <div class="satisfaction-bar flex-grow-1">
                                <div class="bar-fill" [style.width.%]="ratingPercents[5]">
                                    <!-- <span>{{ ratingPercents[5] }}%</span> -->
                                </div>
                            </div>
                        </div>
                        <div class="rating-box d-flex align-items-center gap-2">
                            <h4 class="m-0" style="font-size: 20px;">4</h4>
                            <!-- <div class="progress mb-1" role="progressbar" aria-label="Basic example" style="height: 10px; width: 323px;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                                <div class="progress-bar" style="width: 30%; border-radius: 20px; background-color: rgba(255, 189, 103, 1);"></div>
                            </div> -->
                            <div class="satisfaction-bar flex-grow-1">
                                <div class="bar-fill" [style.width.%]="ratingPercents[4]">
                                    <!-- <span>{{ ratingPercents[4] }}%</span> -->
                                </div>
                            </div>
                        </div>
                        <div class="rating-box d-flex align-items-center gap-2">
                            <h4 class="m-0" style="font-size: 20px;">3</h4>
                            <div class="satisfaction-bar flex-grow-1">
                                <div class="bar-fill" [style.width.%]="ratingPercents[3]">
                                    <!-- <span>{{ ratingPercents[3] }}%</span> -->
                                </div>
                            </div>
                        </div>
                        <div class="rating-box d-flex align-items-center gap-2">
                            <h4 class="m-0" style="font-size: 20px;">2</h4>
                            <div class="satisfaction-bar flex-grow-1">
                                <div class="bar-fill" [style.width.%]="ratingPercents[2]">
                                    <!-- <span>{{ ratingPercents[2] }}%</span> -->
                                </div>
                            </div>
                        </div>
                        <div class="rating-box d-flex align-items-center gap-2">
                            <h4 class="m-0" style="font-size: 20px;">1</h4>
                            <div class="satisfaction-bar flex-grow-1">
                                <div class="bar-fill" [style.width.%]="ratingPercents[1]">
                                    <!-- <span>{{ ratingPercents[1] }}%</span> -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>

            <div class="col-md-8">

                <div class="search-bar p-2">
                    <img [src]="searchIcon" alt="searchIcon" class="search-icon">
                    <input
                    type="search"
                    class="search-input w-100"
                    placeholder="Search reviews"
                    [(ngModel)]="searchText"
                    (input)="onSearch()"
                  />                
                </div>

                  <div *ngIf="errorMessage" class="error-message text-center text-danger pt-2">
                    {{ errorMessage }}
                  </div>
                  <div *ngIf="searchResults.length > 0" id="searchResults">
                    <div *ngFor="let result of searchResults" class="result-item  text-center">
                      {{ result.name }}
                    </div>

                </div>

                <div class="filter-reviews ">
                    <div class="d-flex justify-content-between">
                        <div>
                            <button class="mt-3 me-2" (click)="toggleFilterOptions = !toggleFilterOptions">Filters</button>
                            <button class="mt-3" (click)="sortByMostRecent()">Most Recent</button>
                        </div>
                      
                        <button class="mt-3 mx-1" (click)="resetFilters()">Reset</button>
                    </div>
                    
                  
                    <div *ngIf="toggleFilterOptions" class="mt-2 ">
                      <button class="me-2 btn btn-outline-secondary" (click)="filterByRating('high')">Highest Rating</button>
                      <button class="btn btn-outline-secondary" (click)="filterByRating('low')">Lowest Rating</button>
                    </div>

                </div>

                      
                <div class="reviews-container " style="max-height: 400px; overflow-y: auto;">
                    <div class="reviews mt-3 bg-light-subtle p-4" 
                        *ngFor="let review of reviewsData | reviewFilter: searchText" 
                        style="border-radius: 20px;">
                                    
                        <div class="profile-info d-flex justify-content-between">
                            <div class="d-flex">
                                <img [src]="review?.userImageURl " 
                                class="profile-pic rounded-circle" 
                                alt="profile-pic"
                                (error)="handleImageError($event)"
                                (change)="uploadProfileImg($event)">
                                <div class="ms-2 d-block">
                                    <p class="fw-bold m-0">{{review.username}}</p>
                                    <p class="m-0">{{review.nationality}}</p>
                                    <div class="rating">
                                        <span *ngFor="let star of [1, 2, 3, 4, 5]; let i = index" class="rate">
                                            <svg width="24" height="24" viewBox="0 0 24 24"
                                                xmlns="http://www.w3.org/2000/svg"
                                                [style.fill]="i < review.rating ? '#FAC817' : '#FFFFFF'"
                                                stroke="currentColor" stroke-width="1"
                                                stroke-linecap="round" stroke-linejoin="round">
                                                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                                            </svg>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <i class="fa-solid fa-ellipsis" role="button"></i>
                            </div>
                        </div>
                
                        <div class="review-content">
                            <p class="mt-3 mb-1" style="font-weight: 600;">{{review.reviewTitle}}</p>
                            <p style="font-size: 14px;">{{review.date | date: 'MMMM y'}}<span class="fw-bolder">.</span> {{review.vistorType}}</p>
                            <p style="line-height: 16.94px; font-size: 14px;">
                                {{review.comment}}
                            </p>
                        </div>
                
                        <div class="review-info">
                            <p class="m-0" style="font-size: 11px; line-height: 13.31px;">Written {{review.createdAt | date: 'MMMM d, y' }}</p>
                        </div>
                
                    </div>
                
                    <p *ngIf="reviewsData.length === 0" class="mt-4 text-center text-danger">No reviews yet.</p>

                </div>

            </div>
        </div>
      

    </div>

</section>
