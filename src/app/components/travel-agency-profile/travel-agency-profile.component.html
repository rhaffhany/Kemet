<section class="pb-5">
    <img [src]="layoutPic" alt="layoutPic" class="w-100 mt-5 pt-4" >

    <!-- profile info -->
    <div class="container">
        <div class="row justify-content-center align-items-center">
          <div class="col-12 col-md-11 p-0 profile-box">
            <div class="row align-items-center my-3 my-md-5 ps-md-2">
              <!-- Profile Picture -->
              <div class="col-12 col-md-3 text-center mb-3 mb-md-0">
                <div class="profile-pic rounded-circle mx-auto" style="max-width: 200px;">
                  <img 
                    [src]="travelpp"
                    alt="Profile Image" 
                    class="profile-img rounded-circle w-100">
                </div>
              </div>
      
              <!-- Profile Info -->
              <div class="col-12 col-md-6 text-center text-md-start">
                <div class="profile-info">
                  <h5 class="name fw-bold mb-1">{{travelAgencyData?.userName}}</h5>
                  <p class="lead username" style="font-size: 12px;">{{ user }}{{travelAgencyData?.userName}}</p>

                  <div class="d-flex justify-content-center justify-content-md-start mt-3 mt-md-5 info">
                    <h5 class="fw-bold me-3">0 Followers</h5>
                    <h5 class="fw-bold">0 Following</h5>
                  </div>

                </div>
              </div>
      
              <!-- Review Button -->
              <div class="col-12 col-md-3 text-center text-md-end px-md-4 mt-3 mt-md-0 edit-button">
                <button class="btn btn-outline-warning review-btn" (click)="openModal()">
                    Add Review
                </button>
              </div>

            </div>
          </div>
        </div>
    </div>

    <!-- information section -->
    <div class="container">
        <div class="row justify-content-center">
             <!-- Information Column -->
            <div class="col-12 col-md-3 me-md-4 information mb-4 mb-md-0">
                <!-- information items -->
                <div class="information-items py-4 px-3">
                    <div class="location item d-flex">
                        <i class="fa-regular fa-id-card me-2"></i>
                        <p class="mb-0 text-break">{{travelAgencyData.address}}</p>
                    </div>
                    <div class="calendar item d-flex">
                        <img [src]="calendarIcon" alt="calendarIcon" class="me-2">
                        <p class="mb-0">Joined Oct 2024</p>
                    </div>
                    <div class="website item d-flex">
                        <i class="fa-brands fa-instagram me-2"></i>
                        <a class="text-decoration-none text-black mb-0 text-break" [href]="travelAgencyData.instagramURL" target="_blank">{{travelAgencyData.instagramURL}}</a>
                    </div>
                    <div class="website item d-flex">
                        <i class="fa-brands fa-facebook-f me-2"></i>
                        <a class="text-decoration-none text-black mb-0 text-break" [href]="travelAgencyData.facebookURL" target="_blank">{{travelAgencyData.facebookURL}}</a>
                    </div>
                    <div class="bio item d-flex">
                        <img [src]="bioIcon" alt="bioIcon" class="me-2">
                        <p class="mb-0 text-break">{{travelAgencyData.description}}</p>
                    </div>
                </div>

                <!-- rating box -->
                <!-- <div class="reviews-avg-box information-items p-3 mt-5">
                    <div class="d-flex align-items-center">
                        <h3 class="fw-bolder me-2">{{travelAgencyData.}}</h3>
                        <span *ngFor="let star of [1, 2, 3, 4, 5]; let i = index" class="rate">
                            <svg *ngIf="i + 1 <= placeDetails.averageRating" width="24" height="24" viewBox="0 0 24 24"
                                 xmlns="http://www.w3.org/2000/svg" fill="#FAC817" stroke="currentColor"
                                 stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                              <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                            </svg>
                          
                            <svg *ngIf="i < placeDetails.averageRating && i + 1 > placeDetails.averageRating" width="24" height="24" viewBox="0 0 24 24"
                                 xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="1"
                                 stroke-linecap="round" stroke-linejoin="round">
                              <defs>
                                <linearGradient id="half-fill" x1="0" x2="1" y1="0" y2="0">
                                  <stop offset="50%" stop-color="#FAC817"/>
                                  <stop offset="50%" stop-color="#FFFFFF"/>
                                </linearGradient>
                              </defs>
                              <polygon fill="url(#half-fill)" points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                            </svg>

                            <svg *ngIf="i + 1 > placeDetails.averageRating" width="24" height="24" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg" fill="#FFFFFF" stroke="currentColor"
                                stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                            </svg>

                        </span>
                          
                    </div>

                    <div class="rating-rate d-block align-items-center p-2">                          
                        <div class="rating-box d-flex align-items-center gap-2  ">
                            <h4 class="m-0" style="font-size: 20px;" >5</h4>
                            <div class="progress mb-1" role="progressbar" aria-label="Basic example" style="height: 10px; width: 323px;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                                <div class="progress-bar" style="width: 75%; border-radius: 20px; background-color: rgba(255, 189, 103, 1);"></div>
                            </div>
                        </div>
                        <div class="rating-box d-flex align-items-center gap-2">
                            <h4 class="m-0" style="font-size: 20px;">4</h4>
                            <div class="progress mb-1" role="progressbar" aria-label="Basic example" style="height: 10px; width: 323px;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                                <div class="progress-bar" style="width: 30%; border-radius: 20px; background-color: rgba(255, 189, 103, 1);"></div>
                            </div>
                        </div>
                        <div class="rating-box d-flex align-items-center gap-2">
                            <h4 class="m-0" style="font-size: 20px;">3</h4>
                            <div class="progress mb-1" role="progressbar" aria-label="Basic example" style="height: 10px; width: 323px;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                                <div class="progress-bar" style="width: 20%; border-radius: 20px; background-color: rgba(255, 189, 103, 1);"></div>
                            </div>
                        </div>
                        <div class="rating-box d-flex align-items-center gap-2">
                            <h4 class="m-0" style="font-size: 20px;">2</h4>
                            <div class="progress mb-1" role="progressbar" aria-label="Basic example" style="height: 10px; width: 323px;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                                <div class="progress-bar" style="width: 5%; border-radius: 20px; background-color: rgba(255, 189, 103, 1);"></div>
                            </div>
                        </div>
                        <div class="rating-box d-flex align-items-center gap-2">
                            <h4 class="m-0" style="font-size: 20px;">1</h4>
                            <div class="progress mb-1" role="progressbar" aria-label="Basic example" style="height: 10px; width: 323px;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                                <div class="progress-bar" style="width: 25%; border-radius: 20px; background-color: rgba(255, 189, 103, 1);"></div>
                            </div>
                        </div>
                    </div>
                    
                </div> -->

            </div>

            <div class="col-12 col-md-8 p-3">
              <div class="carousel-container">
                <owl-carousel-o [options]="photoSlider">
                  <ng-template carouselSlide *ngFor="let image of images">
                    <div class="carousel-item">
                      <img [src]="image" alt="Photo" class="carousel-img w-100">
                    </div>
                  </ng-template>
                </owl-carousel-o>
              </div>

              <!-- All Pacakages -->
              <div class="packages-booking mt-3">
                <div class="package bg-white p-3 d-flex flex-column flex-md-row mb-2" *ngFor="let package of packages" >

                  <div class="col-12 col-md-9 d-flex flex-column flex-md-row" [routerLink]="['/Package-details',package.planId]">
                    <div class="package-container">
                      <img [src]="package.imageURLs" alt="pic" class="package-pic w-100" style="max-width: 170px; height: auto;">
                      <i class="fa-regular fa-heart favorite-icon"></i>
                    </div>
                    <div class="d-block ms-md-3 mt-3 mt-md-0">
                      <p class="location text-muted mb-1" style="font-size: 18px;">{{package.planName}}, {{package.description}}</p>
                      <p><i class="fa-solid fa-location-arrow"></i> <span class="ms-1 text-muted">{{package.duration}} Days Trip</span></p>
                      <p class="text-muted">{{package.egyptianStudent | currency:'EGP'}} - {{package.touristAdult | currency:'EGP'}}</p>
                    </div>
                  </div>
                  <div class="col-12 col-md-3 book-btn mt-3 mt-md-0 text-center text-md-end">
                    <button class="btn fw-bolder w-100 w-md-auto">Book</button>
                  </div>
                  
                </div>
              </div>
              
            </div>

        </div>
    </div>

    <!-- reviews -->
    <div class="container py-5">
      <div class="row gap-3 mt-5 align-content-center justify-content-center">

          <div class="col-12 col-md-8">

              <div class="search-bar p-2">
                <img [src]="searchIcon" alt="searchIcon" class="search-icon">
                <input
                type="search"
                class="search-input w-100"
                placeholder="Search reviews"
                [(ngModel)]="searchText"
                (input)="onSearch()"
              />
              </div>

              <div *ngIf="errorMessage" class="error-message text-center text-danger pt-2">
                {{ errorMessage }}
              </div>
              <div *ngIf="searchResults.length > 0" id="searchResults">
                <div *ngFor="let result of searchResults" class="result-item  text-center ">
                  {{ result.name }}
                </div>
              </div>

          </div>

          <div class="col-12 col-md-8 filter-reviews">
                <div class="d-flex flex-column flex-md-row justify-content-between">
                    <div class="d-flex flex-wrap">
                        <button class="mt-3 me-2" (click)="toggleFilterOptions = !toggleFilterOptions">Filters</button>
                        <button class="mt-3" (click)="sortByMostRecent()">Most Recent</button>
                    </div>
                  
                    <button class="mt-3 mx-1" (click)="resetFilters()">Reset</button>
                </div>
                
              
                <div *ngIf="toggleFilterOptions" class="mt-2">
                  <button class="me-2 btn btn-outline-secondary" (click)="filterByRating('high')">Highest Rating</button>
                  <button class="btn btn-outline-secondary" (click)="filterByRating('low')">Lowest Rating</button>
                </div>
          </div>

              
              <div class="reviews-container" style="max-height: 400px; overflow-y: auto;">
                  <div class="reviews mt-3  bg-light-subtle p-4" 
                      *ngFor="let review of reviews | reviewFilter: searchText" 
                      style="border-radius: 20px;">
                                  
                      <div class="profile-info d-flex flex-column flex-md-row justify-content-between">
                          <div class="d-flex">
                              <img [src]="review.userImageURl || profileImg" class="profile-img rounded-circle" 
                                  alt="profile-pic" style="width: 50px; height: 50px;">
                              <div class="ms-2 d-block">
                                  <p class="fw-bold m-0">{{review.username}}</p>
                                  <p class="m-0">{{review.nationality}}</p>
                                  <div class="rating">
                                      <span *ngFor="let star of [1, 2, 3, 4, 5]; let i = index" class="rate">
                                          <svg width="24" height="24" viewBox="0 0 24 24"
                                              xmlns="http://www.w3.org/2000/svg"
                                              [style.fill]="i < review.rating ? '#FAC817' : '#FFFFFF'"
                                              stroke="currentColor" stroke-width="1"
                                              stroke-linecap="round" stroke-linejoin="round">
                                              <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                                          </svg>
                                      </span>
                                  </div>
                              </div>
                          </div>
                          <div class="mt-3 mt-md-0">
                              <i class="fa-solid fa-ellipsis" role="button"></i>
                          </div>
                      </div>
              
                      <div class="review-content">
                          <p class="mt-3 mb-0" style="font-weight: 600;">{{review.reviewTitle}}</p>
                          <p style="font-size: 12px; line-height: 10px;">{{review.date | date: 'MMMM y' }} <span class="fw-bolder" style="font-size: 20px;">.</span> {{review.visitorType}}</p>
                          <p style="line-height: 16.94px; font-size: 14px;">
                              {{review.comment}}
                          </p>
                      </div>
              
                      <div class="review-info">
                          <p class="m-0" style="font-size: 11px; line-height: 13.31px;">Written {{review.createdAt | date: 'MMMM d, y' }}</p>
                      </div>
              
                  </div>
              </div> 

              <p *ngIf="reviews.length === 0" class="mt-4 text-center text-danger">No reviews yet.</p>

          </div>
    </div>
  
    <!-- reviews box -->
   <div *ngIf="showModal" class="overlay d-flex align-items-center justify-content-center" (click)="closeModal($event)">
      <div class="modal-container text-center p-4" style="max-width: 600px; width: 90%;" (click)="$event.stopPropagation()">
          <button class="close-btn position-absolute end-0 top-0 m-3" (click)="showModal = false"><i class="fa-solid fa-xmark"></i></button>
  
          <!-- Q1: Rating -->
          <p class="mb-0 mt-4">How would you rate your experience?</p>
          <div class="stars rate mb-2 d-flex justify-content-center">
              <span *ngFor="let star of stars; let i = index" class="rate"
                  (click)="rate(i + 1)" 
                  (mouseenter)="setHover(i + 1)" 
                  (mouseleave)="clearHover()">
                  <svg width="33" height="30" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"  
                      [ngStyle]="{ fill: i < (hoverRating || rating) ? '#FAC817' : '#FFFFFF' }" 
                      stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                      <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                  </svg>
              </span>
          </div>
  
          <!-- Q2: Date Picker -->
          <p class="mb-0">When did you go?</p>
          <div class="datepicker-container position-relative mb-2 d-flex flex-column align-items-center">
              <button class="selection-btn mt-1" style="width: 200px;" (click)="d.toggle()">Select Date</button>
              <input type="text" ngbDatepicker #d="ngbDatepicker" (dateSelect)="onDateSelect($event)" class="visually-hidden" />
              <p *ngIf="selectedDate" class="selected-date fw-bold mb-1">{{ selectedDate | date: 'longDate' }}</p>
          </div>

          <p class="mb-1">Who did you go with?</p>
          <div class="choices d-flex flex-wrap justify-content-center gap-2">
              <button class="selection-btn"
              *ngFor="let option of options"
              [class.selected]="selectedOption === option"
              (click)="selectOption(option)">
              {{ option }}
              </button>
          </div>
  
          <!-- Review Textarea -->
          <p class="mb-1 mt-3">Write a review</p>
          <textarea name="review" class="review w-100 p-2" rows="5" [(ngModel)]="reviewText"></textarea>

          <!-- title of review -->
          <p class="mb-1">Title your review</p>
          <input type="text" class="p-2 w-100" (input)="onReviewChange($event)" [(ngModel)]="reviewTitle">
  
          <!-- Submit Button -->
          <div class="mt-4">
              <button class="submit-btn fw-bold w-100" type="submit" (click)="submitReview()" [disabled]="!isAdded || loading">
                  <span *ngIf="!loading">Submit</span>
                  <span *ngIf="loading">
                      <i class="spinner-border spinner-border-sm"></i> Loading...
                  </span>
              </button>
          </div>
      </div>
   </div>

</section>